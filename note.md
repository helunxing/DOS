

## [分布式对象存储](https://book.douban.com/subject/30456816/)

#### c1 介绍

nas以文件管理数据， san以数据块存储， 对象存储以对象存储。 nas与硬件耦合度较高。 

#### c2 分布式系统

分布式系统的要求：分布在网络上， 通过消息传递合作完成共同目标。节点之间并发工作。
没有全局锁。某个节点出错不影响其他节点。易扩展。

简单地实现了写入和读取。还没有体现分布式，也没有体现对象存储。

架构如P16图2-2

两种接口： 接口服务作为http客户端使用数据服务的rest接口； 
rabbitmq实现通信， 数据节点向接口节点发送心跳， 接口节点向数据节点发送定位信息。 
有数据的节点消息单发到接口节点。 
原因：对象存储可能传送比较大文件， 适合http。 但http不适合消息群发。 

p30未看懂

数据多版本问题。数据重复占用空间问题。

#### c3 元数据服务

元数据服务可以实现不删除数据即实现删除功能，可以实现版本控制。

#### c4 校验和去重

在小文件上传时，会有为了去重而产生的等待定位时间。

通过免除小对象定位可减少等待。但会导致磁盘节点多份存储，多节点响应查询。

可以实现定期清理临时对象的功能

#### c5 冗余和修复

reed solomon纠错码：M+N分片方案

PUT接口后分片，分别向数据节点temp传。

#### c6 断点续传

range头即可实现断点下载

上传需要考虑hash问题。改用post方法提供大小和hash值，给客户端一个token以继续上传，range头指定上传数据范围。接口需要有响应head方法写入进度的功能。

#### c7 数据压缩

客户端适合实现压缩。文本适合压缩。客户端解压与服务端解压。

数据服务：转正时实现压缩，读取前先解压。

接口服务：上传时http正文压缩

